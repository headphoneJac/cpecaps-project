<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <title>Baked Sisig</title>
</head>
<body>
    <br><br>
    <nav>
        <ul class="navigationBar">
            <li><a href="homeCustomer.html">Home</a></li>
            <li><a href="menuCustomer.html">Menu</a></li>
            <li><a href="viewOrder.html">Orders</a></li>
            <li><a href="home.html">Logout</a></li>
        </ul>
    </nav>
    <br><br>
    <div class="containerCenter">
        <div class = "row">
            <div class = "columnForItems">
                <p id="itemName"></p>
                    <script>
                        const itemName = localStorage.getItem("itemName");   
                        document.getElementById("itemName").textContent = itemName;                       
                    </script>
                <img id="itemImage">
                    <script>
                        const imageToDisplay = localStorage.getItem("imageToDisplay");
                        const img = document.getElementById("itemImage");
                        img.src = imageToDisplay;                    
                    </script>
            </div>
            <div class = "columnForItems" style="margin-top:100px">         
                <a id="price"></a>
                    <script>
                        const itemPrice = localStorage.getItem("itemPrice");    
                        document.getElementById("price").textContent = "PhP " + itemPrice;                        
                    </script>
                <button class="styleButton circleButton" onclick="subPrice()">-</button>
                <a id="amount">1</a>
                <button class="styleButton circleButton" onclick="addPrice()">+</button>
                <br><br>
                <button id = "addOrders" class="styleButton boxButton"> Add to my Order</button>
            </div>
        </div>
    </div>
</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
    import { getDatabase, ref, set , child, push, update, get} from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";
    import { getAuth, onAuthStateChanged} from "https://www.gstatic.com/firebasejs/9.18.0/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyBqyyKsQ3Wk6reiLm8k9qBAuz59cZk3PbU",
    authDomain: "cpecaps-project.firebaseapp.com",
    databaseURL: "https://cpecaps-project-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "cpecaps-project",
    storageBucket: "cpecaps-project.appspot.com",
    messagingSenderId: "1002343899498",
    appId: "1:1002343899498:web:125ea29ca0d15d98090513",
    measurementId: "G-0XXL384QBN"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();
    const db = getDatabase();
    const amountText = parseInt(document.getElementById("amount").textContent);
    addOrders.addEventListener('click', (e) => {
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userId = user.uid;
                var num1 = document.getElementById("amount").value;
                switch(document.getElementById("itemName").innerHTML){
                case "Mango Sticky Rice": //based on the name of the item menu, amount will be changed with its corresponding amount for the itemS
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        mangoStickyRice: parseInt(document.getElementById("amount").textContent)
                    })
                    break;
                case "Sisig ala Carte":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        sisigAlaCarte: parseInt(document.getElementById("amount").textContent)                
                    })
                    break;
                case "Baked Sisig ala Carte":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        bakedSisigAlaCarte: parseInt(document.getElementById("amount").textContent)                   
                    })
                    break;
                case "Mango Sticky Rice Party":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        mangoStickyRiceParty: parseInt(document.getElementById("amount").textContent)                   
                    })
                    break;
                case "Sisig ala Carte Party":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        sisigAlaCarteParty: parseInt(document.getElementById("amount").textContent)                   
                    })
                    break;
                case "Baked Sisig ala Carte Party":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        bakedSisigParty: parseInt(document.getElementById("amount").textContent)                   
                    })
                    break;
                case "Bundle A":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        bundleA: parseInt(document.getElementById("amount").textContent)                   
                    })
                    break;
                case "Bundle B":
                    update(ref(database, 'customerUsers/' + user.uid + '/itemMenus'), {                
                        bundleB: parseInt(document.getElementById("amount").textContent)                   
                    })
                    break;       
                }alert('order added!');
                
                //total amount                
                get(ref(database, 'customerUsers/' + user.uid + '/itemMenus/')).then((snapshot) =>{
                    const data = snapshot.val();
                    var totalPrice=0;
                    
                    for (var itemName in data) {
                        var amount = data[itemName];
                        switch(itemName){
                            case "mangoStickyRice":
                                var price = 90*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "sisigAlaCarte":
                                var price = 250*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "bakedSisigAlaCarte":
                                var price = 300*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "mangoStickyRiceParty":
                                var price = 250*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "sisigAlaCarteParty":
                                var price = 700*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "bakedSisigParty":
                                var price = 1100*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "bundleA":
                                var price = 1340*amount;
                                totalPrice = totalPrice + price;
                                break;
                            case "bundleB":
                                var price = 2120*amount;
                                totalPrice = totalPrice + price;
                                break;        
                        }                        
                    }                    
                    alert("Total price right now is PhP "+totalPrice);
                    update(ref(database, 'customerUsers/' + user.uid), {                        
                        totalPrice: totalPrice
                        })
                }) 
            } 
            else {
                // User is signed out
                // ...
            }
        });
    })
</script>
</html>